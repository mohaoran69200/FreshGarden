{% extends 'base.html.twig' %}

{% block title %}Modifier Profil{% endblock %}
{% block importmap %}{{ importmap(['app', 'form', 'header']) }}{% endblock %}

{% block body %}
    <div class="form-container">
        <h1 class="form-title">Modifier votre profil</h1>

        <div class="profile-section">
            <!-- Photo de profil -->
            <div class="profile-image-container">
                <img id="profile-image" class="profile-image"
                     src="{{ user.userProfile is not null and user.userProfile.imageName is not null ? vich_uploader_asset(user.userProfile, 'imageFile')
                     : asset('images/utilisateur.png') }}"
                     alt="Photo de profil">
                <!-- Formulaire pour l'image -->
                {{ form_start(imageForm, { 'attr': {'id': 'image-form'} }) }}
                {{ form_widget(imageForm.imageFile, {'attr': {'id': 'image-input', 'accept': 'image/*'}}) }}
                {{ form_errors(imageForm.imageFile) }}
                <button type="submit" class="btn-primary" id="upload-image-btn">Mettre à jour la photo</button>
                {{ form_end(imageForm) }}

                <!-- Bouton pour supprimer l'image -->
                {% if user.userProfile is not null %}
                    <form method="POST" action="{{ path('app_user_delete_image') }}">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete_image' ~ user.userProfile.id) }}">
                        <button type="submit" class="btn-primary">Supprimer l'image</button>
                    </form>
                {% else %}
                {% endif %}
            </div>
        </div>

        <div class="info-forms">
            <div class="toggle-forms">
                <div class="toggle-header" onclick="toggleForm('personal-info', 'arrow-personal')">
                    <h3>Modifier informations personnelles <span id="arrow-personal" class="arrow">▶</span></h3>
                </div>
                <div id="personal-info" class="form-section" style="display: none;">
                    {{ form_start(personalForm) }}

                    <div class="form-group">
                        {{ form_label(personalForm.userName) }}
                        {{ form_widget(personalForm.userName, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(personalForm.userName) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(personalForm.firstName) }}
                        {{ form_widget(personalForm.firstName, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(personalForm.firstName) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(personalForm.lastName) }}
                        {{ form_widget(personalForm.lastName, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(personalForm.lastName) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(personalForm.dateBirth) }}
                        {{ form_widget(personalForm.dateBirth, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(personalForm.dateBirth) }}
                    </div>

                    <div class="form-group">
                        {{ form_label(personalForm.gender) }}
                        {{ form_widget(personalForm.gender, {'attr': {'class': 'form-select'}}) }}
                        {{ form_errors(personalForm.gender) }}
                    </div>

                    {{ form_end(personalForm) }}
                </div>

                <div class="toggle-header" onclick="toggleForm('address-info', 'arrow-address')">
                    <h3>Modifier adresse de facturation <span id="arrow-address" class="arrow">▶</span></h3>
                </div>
                <div id="address-info" class="form-section" style="display: none;">
                    {{ form_start(addressForm) }}
                    <div class="form-group">
                        {{ form_label(addressForm.address) }}
                        {{ form_widget(addressForm.address, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(addressForm.address) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(addressForm.postalCode) }}
                        {{ form_widget(addressForm.postalCode, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(addressForm.postalCode) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(addressForm.city) }}
                        {{ form_widget(addressForm.city, {'attr': {'class': 'form-input'}}) }}
                        {{ form_errors(addressForm.city) }}
                    </div>
                    {{ form_end(addressForm) }}
                </div>
            </div>

            <div class="form-footer">
                <a href="{{ path('app_user_edit_user_password', {'id': user.id}) }}" class="btn-primary">Modifier mon mot de passe</a>
                <a href="{{ path('app_user_edit_user_contact', {'id': user.id}) }}" class="btn-primary">Modifier mes coordonnées</a>
                <a class="btn-primary" href="{{ path('app_user_remove', {'id': user.id}) }}"
                   onclick="return confirm('Êtes-vous sûr de vouloir supprimer votre compte ?')">
                    Supprimer mon compte
                </a>
            </div>
        </div>
    </div>

{% endblock %}
